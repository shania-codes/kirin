{% extends "base.html" %}

{% block title %}
Kirinify
{% endblock %}

{% block header %}
Kirinify - JS-free
{% endblock %}


{% block body %}
<h2>Upload</h2>
<form method="post" enctype=multipart/form-data>
    <input hidden name="form" value="new_song">
    <label>Audio files</label>
    <input type="file" name="audio" accept="audio/flac, audio/mp3">
    <button  type="submit">Submit</button>
</form>


<h2>Filter songs by tags</h2>
<form method="get">
    <label>Select Tags:<small>(comma_seperated,case_sensitive)</small></label>
    <input type="text" name="filter_tag">
    <select name="match_mode">
        <option value="any" {%if match_mode == "any"%}selected{%endif%}>Any of these tags</option>
        <option value="all" {%if match_mode =="all"%}selected{%endif%}>All of these tags</option>
    </select>
    <button type="submit">Filter</button>
</form>


{% if filter_tag %}
<p>
    Showing songs with 
    {% if match_mode == 'all' %}
        <strong>all</strong> of these tags:
    {% else %}
        <strong>any</strong> of these tags:
    {% endif %}
    "{{ filter_tag }}"
</p>
{% endif %}

<br><h2>Songs</h2>
<ul>
{% for file in files %}
    <li id="li{{ loop.index0 }}" style="display:inline;">{{file}}
    <audio controls src="./static/{{file}}"></audio>
    <form method="post">
        <input hidden name="form" value="add_tag_to_song">
        <input hidden name="file" value="{{file}}">
        <label>Tag name <small>(case-sensitive)</small></label>
        <input id="tag" type="text" name="tag" required>
        <button type="submit">Add Tag</button>
    </form>
    <form method="post">
        <input hidden name="form" value="delete_song">
        <input hidden name="file" value="{{file}}">
        <button type="submit">Delete Song</button>
    </form>
    <form method="get" action="{{url_for('download_song', filename=file)}}">
        <button type="submit">Download Song</button>
    </form>
    </li>
    <br>
{% endfor %}
</ul>


<br><h2>Tags</h2>
<ul>
    {% for tag in tags %}
    <li>
        {{tag[1]}}
        <form method="post" style="display: inline;">
            <input hidden name="form" value="delete_tag">
            <input hidden name="tag_id" value="{{tag[0]}}">
            <button type="submit">Delete Tag</button>
        </form>
    </li>
    {% else %}
    <li>No tags yet.</li>
    {% endfor %}
</ul>


<h2>Download All Songs (.zip)</h2>
<a href="/backup"><button>Download All Songs</button></a>

<div id="kirin" style="position: fixed;bottom: 0;right:0;z-index: -1;">
    <img src="./static/kirin.png" style="max-width: 350px;">
</div>

<style>
    body {
        background-image: url(./static/background.png);
        background-repeat: no-repeat;
        background-position: top right;
        background-size:contain;
        max-height: 450px;
    }
    button {
        background-color: orangered;
        padding: 10px;
        border-color: yellow;
        border-radius: 20px;
        font-weight: bold;
    }
    audio {
        border: solid greenyellow 10px;
        border-radius: 40px;
    }
</style>
<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br>
{% endblock %}